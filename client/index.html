<!DOCTYPE html>
<html>
  <body>

    <script>
        

        // const address = "wss://8080-ab5110a9-8b2a-46fe-a022-961d36b7431b.ws-us02.gitpod.io/wpilibws";
        const address = `wss://8080${window.location.href.substring(12)}wpilibws`;
        var socketOpen = false;
        var socket = null;

        function createSocket(onMessage, onClose) {

            socket = new WebSocket(address);
            if (socket) {
                socket.onopen = function () {
                console.info("Socket opened");
                socketOpen = true;
                };

                socket.onmessage = function (msg) {
                var data = JSON.parse(msg.data);
                onMessage(data);
                };

                socket.onclose = function () {
                if (socketOpen) {
                    console.info("Socket closed");
                    socket = null;
                    onClose();
                }
                // respawn the websocket
                setTimeout(() => {
                    createSocket(onMessage, onClose);
                }, 300);
                };
            }
        }

        createSocket(msg => {
            console.log('msg:', msg);
        }, () => {});


    </script>


    <frc-dashboard>
      <frc-gyro edit-mode address-type="gitpod"></frc-gyro>
    </frc-dashboard>
    <script src="./node_modules/@frc-web-components/frc-web-components/build/frc-web-components.min.js"></script>
  </body>
</html>